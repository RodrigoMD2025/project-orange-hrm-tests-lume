name: 🔍 Code Quality Check

on:
  push:
    branches:
      - master
      - main
      - develop
  pull_request:
    branches:
      - master
      - main

jobs:
  code-quality:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4
        
      - name: ⚙️ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'
          
      - name: 📦 Install Dependencies
        run: npm ci
        
      - name: 🔍 Lint JavaScript Files
        run: |
          # Verificar se existe ESLint configurado
          if [ -f "package.json" ] && grep -q "eslint" package.json; then
            npm run lint || echo "⚠️ ESLint não configurado"
          else
            echo "ℹ️ ESLint não encontrado, pulando verificação"
          fi
        continue-on-error: true
        
      - name: 📋 Validate Cypress Config
        run: |
          echo "🔧 Validando configuração do Cypress..."
          npx cypress verify
          npx cypress info
          
      - name: 🧪 Validate Test Structure
        run: |
          echo "📁 Verificando estrutura dos testes..."
          
          # Verificar se existem arquivos de teste
          if [ ! -d "cypress/e2e" ] || [ -z "$(find cypress/e2e -name '*.cy.js')" ]; then
            echo "❌ Nenhum arquivo de teste encontrado!"
            exit 1
          fi
          
          # Contar arquivos de teste
          TEST_COUNT=$(find cypress/e2e -name "*.cy.js" | wc -l)
          echo "✅ Encontrados $TEST_COUNT arquivos de teste"
          
          # Listar arquivos de teste
          echo "📋 Arquivos de teste:"
          find cypress/e2e -name "*.cy.js" -exec basename {} \;
          
      - name: 📊 Code Quality Summary
        if: always()
        run: |
          echo "## 🔍 Relatório de Qualidade de Código" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 📁 Estrutura Validada:" >> $GITHUB_STEP_SUMMARY
          echo "- ✅ Configuração do Cypress verificada" >> $GITHUB_STEP_SUMMARY
          echo "- ✅ Estrutura de testes validada" >> $GITHUB_STEP_SUMMARY
          echo "- ✅ Arquivos de teste encontrados: $(find cypress/e2e -name '*.cy.js' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### 🎯 Próximas Etapas:" >> $GITHUB_STEP_SUMMARY
          echo "- Os testes E2E serão executados pelo workflow principal" >> $GITHUB_STEP_SUMMARY
          echo "- Relatórios e vídeos serão gerados automaticamente" >> $GITHUB_STEP_SUMMARY
