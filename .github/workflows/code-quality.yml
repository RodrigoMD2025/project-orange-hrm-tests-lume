name: ðŸ” Code Quality Check

on:
  push:
    branches:
      - master
      - main
      - develop
  pull_request:
    branches:
      - master
      - main

jobs:
  code-quality:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'
          
      - name: ðŸ“¦ Install Dependencies
        run: npm ci
        
      - name: ðŸ” Lint JavaScript Files
        run: |
          # Verificar se existe ESLint configurado
          if [ -f "package.json" ] && grep -q "eslint" package.json; then
            npm run lint || echo "âš ï¸ ESLint nÃ£o configurado"
          else
            echo "â„¹ï¸ ESLint nÃ£o encontrado, pulando verificaÃ§Ã£o"
          fi
        continue-on-error: true
        
      - name: ðŸ“‹ Validate Cypress Config
        run: |
          echo "ðŸ”§ Validando configuraÃ§Ã£o do Cypress..."
          npx cypress verify
          npx cypress info
          
      - name: ðŸ§ª Validate Test Structure
        run: |
          echo "ðŸ“ Verificando estrutura dos testes..."
          
          # Verificar se existem arquivos de teste
          if [ ! -d "cypress/e2e" ] || [ -z "$(find cypress/e2e -name '*.cy.js')" ]; then
            echo "âŒ Nenhum arquivo de teste encontrado!"
            exit 1
          fi
          
          # Contar arquivos de teste
          TEST_COUNT=$(find cypress/e2e -name "*.cy.js" | wc -l)
          echo "âœ… Encontrados $TEST_COUNT arquivos de teste"
          
          # Listar arquivos de teste
          echo "ðŸ“‹ Arquivos de teste:"
          find cypress/e2e -name "*.cy.js" -exec basename {} \;
          
      - name: ðŸ“Š Code Quality Summary
        if: always()
        run: |
          echo "## ðŸ” RelatÃ³rio de Qualidade de CÃ³digo" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Estrutura Validada:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ConfiguraÃ§Ã£o do Cypress verificada" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Estrutura de testes validada" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Arquivos de teste encontrados: $(find cypress/e2e -name '*.cy.js' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ PrÃ³ximas Etapas:" >> $GITHUB_STEP_SUMMARY
          echo "- Os testes E2E serÃ£o executados pelo workflow principal" >> $GITHUB_STEP_SUMMARY
          echo "- RelatÃ³rios e vÃ­deos serÃ£o gerados automaticamente" >> $GITHUB_STEP_SUMMARY
